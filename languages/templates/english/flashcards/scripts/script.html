<script>
    var itrash = '<i class="fa-regular fa-trash"></i>';
    var iplus = '<i class="fa-regular fa-plus"></i>';

    var notifBox = document.getElementById("popupnotifications");
    function notifc(action){
        //let vars = arguments;
        let message = action == 'fav'?'The sense was added!':'The sense was removed';
        let notif = document.createElement("div");
        notif.innerHTML = `
            <div class="alert alert-${action=='fav'?'success':'danger'} alert-dismissible d-flex align-items-center animate__animated animate__fadeIn">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                    ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;
        notifBox.appendChild(notif);
    }
    function favSet(action,id,sense){
        let xhttp = new XMLHttpRequest();
        xhttp.onload = ()=>{
            notifc(action);
            let fele = document.getElementById("btn"+sense);
            if (action == "fav"){
                fele.classList.remove("btn-outline-primary");
                fele.classList.add("btn-outline-danger");
                fele.setAttribute("onclick","favSet('remove',"+id+","+sense+")");
                fele.innerHTML = itrash;
                //fele.getElementById("fp").classList.add("d-none");
                //fele.getElementById("ft").classList.remove("d-none");
            } else {
                fele.classList.remove("btn-outline-danger");
                fele.classList.add("btn-outline-primary");
                fele.setAttribute("onclick","favSet('fav',"+id+","+sense+")");
                fele.innerHTML = iplus;
            }
        }
        xhttp.open("GET","{% url 'data_main' %}?data="+action+"&word="+id+"&sense="+sense, true);
        xhttp.send();
    }

    // Pronounce
    let wds = document.getElementsByClassName("wd");
    let letter = "{{word.word_details.0.0}}";
    for (let wd of wds){
        for (let x of wd.getElementsByClassName("phons_br")){
            for (let y of x.getElementsByTagName("i")){
                y.classList.add("fa-solid","fa-volume-high","cursor-pointer","text-primary","speak");
            }
        }
        for (let x of wd.getElementsByClassName("phons_am")){
            for (let y of x.getElementsByTagName("i")){
                y.classList.add("fa-solid","fa-volume-high","cursor-pointer","text-danger","speak");
            }
        }
    }
    $(".speak").on("click",function(){
        let data = $(this).attr("data-src-mp3");
        let audio = new Audio('/media/dictionary/audio/'+letter+'/'+data);
        audio.play();
    });

    document.addEventListener("click", function(e) {
        if (e.target.getAttribute("data-action") == "dtog"){
            let target = document.getElementById(e.target.getAttribute("data-target"));
            target.classList.toggle("d-none");
        }
    });

    document.addEventListener("dblclick",()=>{
        if (window.getSelection){
            let selection = window.getSelection().toString();
            if (selection) window.location.assign('{% url "dictionary" %}?q='+selection);
        };
    });
</script>

<script>
    let def = document.getElementsByClassName("definition");
    for (let d of def){
        d.innerHTML = d.innerHTML.replace(/[;]/g, "<span class='fw-bold text-primary'>; </span>");
    };

    let example = document.getElementsByClassName("example");
    for (let x of example){
        // Bolding
        let examples = x.getElementsByTagName("li");
        for (let y of examples) {
            let tag_start = false;
    
            if (tag_start == false){
                y.innerHTML = y.innerHTML.replace("*", "<span class='fw-semibold'>");
                tag_start = true;
            }
    
            if (tag_start == true){
                y.innerHTML = y.innerHTML.replace("*", "</span>");
                tag_start = false;
            }
        }

        // Example Shadows
        //let exampleHeight = x.scrollHeight;//example.getBoundingClientRect().height;
        //if ( exampleHeight > 300 ){
        //    x.classList.add("shadow-b");
        //}
        //x.addEventListener("scroll", function(){
        //    if (x.scrollTop > 40){
        //        x.classList.remove("shadow-b");
        //        x.classList.add("shadow-y");
        //    }
        //    if (x.scrollTop > (exampleHeight-x.offsetHeight-2)){
        //        x.classList.remove("shadow-y");
        //        x.classList.add("shadow-t");
        //    }
        //    if (x.scrollTop < 10){
        //        x.classList.remove("shadow-y");
        //        x.classList.add("shadow-b");
        //    }
            //console.log(example.classList);
        //});
    }
</script>

<script src="/static/js/dom-to-image.min.js"></script>
<script src="/static/js/FileSaver.min.js"></script>
<script>
    $(document).ready(function(){
        $(".scr").click(function(){
            $("#scr").removeClass("d-none");
            domtoimage.toBlob(document.getElementById($(this).attr("data-ele")))
            .then(function (blob) {
                window.saveAs(blob, '{{word.word}} {{word.pos}}.png');
            });
        });
        $(".scr").click(function(){
            setTimeout(function(){
                $("#scr").addClass("d-none")
            }, 2000);
        });
    });
</script>
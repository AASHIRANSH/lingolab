{% extends 'base.html' %}
{% block body %}
{% include 'header.html' %}

<div class="container-fluid bg-gray-200 p-3">
    <div class="text-center text-learner display-4 fw-semibold pb-2 mb-2"><i class="fa-solid fa-list"></i> My Learnings</div>

    <div class="px-2">
        <div class="pnav">
            <li class="{% if not request.GET.td %}active{% endif %}">
                <div class="ts-b"></div>
                <a href="{% url "my_words" %}"><i class="fa-solid fa-list"></i> MY WORDS LIST</a>
            </li>
            
            <li class="{% if request.GET.td %}active{% endif %}">
                <div class="ts-b"></div>
                <a href="{% url "my_words" %}?td=true"><i class="fa-solid fa-history"></i> REVIEW LIST</a>
            </li>

            <li class="{% if request.GET.td %}active{% endif %}">
                <div class="ts-b"></div>
                <a href="{% url "my_words" %}?td=true">MAKE NEW LIST <i class="fa-solid fa-plus"></i></a>
            </li>
        </div>
    </div>
</div>
<div class="rule pt-1"></div>

<!-- search -->
<div class="container my-5">
    <div class="swrapper col-10 col-md-8">
        <form>
            <div class="search-input">
                <input type="search" name="q" class="form-control" placeholder="Type to search in your words list..." value="{{request.GET.q}}" autocomplete="off"/>
                <div id="subox" class="autocom-box mt-1 rounded-bottom shadow">
                    <!-- here list is inserted from javascript -->
                </div>
                <a onclick="window.location.assign('?q='+document.querySelector('[type=search]').value)"><div class="icon"><i class="fas fa-search"></i></div></a>
            </div>
        </form>
    </div>
</div>

<div class="container my-5">
    <div class="col-12 col-md-8 mx-auto my-3">
        {% if request.GET.q %}
        <div class="card card-body bg-primary-subtle mb-3">
            <div class="text-center">
                <div class="mb-1">Showing results for &quot;<span class="text-primary fw-bold">{{request.GET.q}}</span>&quot; ({{searchcount}} entries found)</div>
                <a href="{{request.path}}" role="btn" class="btn btn-sm btn-primary">Clear Search</a>
            </div>
        </div>
        {% endif %}

        <div class="card card-body bg-primary-subtle mb-3">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex gap-3 fs-5 fw-semibold text-primary">
                    <span>Total Words</span>
                    <span class="text-secondary">:</span>
                    <span>{{favscount}}</span>
                </div>

                <div>
                    <button class="btn btn-primary" onclick="window.location.assign('{% url "revisemain" %}?back=/english/mywords/{% if request.GET.td %}&td=true{% endif %}')">Practice <i class="fa-solid fa-dumbbell"></i></button>
                </div>
            </div>
        </div>

        <!-- table -->
        <table id="" class="table table-hover rounded overflow-hidden shadow-sm" style="width:100%;">
            <thead>
                <tr class="table-primary">
                    <th class="text-primary" style="width:5%;">#</th>
                    <th class="text-primary" style="width:45%;">Word</th>
                    <th class="text-primary" style="width:20%;">Sense</th>
                    <th class="text-primary" style="width:20%;">Progress</th>
                    <th class="text-primary" style="width:10%;"></th>
                </tr>
            </thead>
            <tbody>
                {% for word in words %}
                <tr onclick="window.location.assign(`{% url 'my_word' word.pk %}`)" class="cursor-pointer">
                    <td class="text-secondary">{% if not forloop.counter == 10%}{{request.GET.page}}{{forloop.counter}}{% else %}{{forloop.counter}}{% endif %}</td>
                    <td>{{word.word}} {% if word.pos %}<span class="text-secondary fst-italic">({{word.pos}})</span>{% endif %}</td>
                    <td><div class="badge text-bg-secondary">{{word.sense.0}}/{{word.sense.1}}</div></td>
                    <td><div class="badge text-bg-primary">{{word.progress}}%</div></td>
                    <td></td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="2" class="fs-7 text-secondary">PAGE {{request.GET.page|default:"1"}} of {{wordsp.paginator.num_pages}}</th>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
                <!--tr>
                    <th>#</th>
                    <th>Word</th>
                    <th>Fav</th>
                </tr-->
            </tfoot>
        </table>
    </div>

    <div id="pagination" class="d-flex justify-content-center"></div>
</div>

<script>// Page Numbers
    let pageEle = document.getElementById("pagination");
    let totalPages = {{wordsp.paginator.num_pages}};
    let currentPage = {{request.GET.page|default:"1"}};
    let pages = ``;
    pages += `<nav aria-label="..."><ul class="pagination">`;
    {//if has Previous
        `{% if wordsp.has_previous %}
            ${pages += '<li class="page-item"><a class="page-link" href="?q={{request.GET.q}}&page={{ wordsp.previous_page_number }}&td={{request.GET.td}}">Previous</a></li>'}
        {% else %}
            ${pages += '<li class="page-item disabled"><span class="page-link">Previous</span></li>'}
        {% endif %}`;
    }
    {//first page
        if (currentPage>3){
            pages += '<li class="page-item"><a class="page-link" href="?q={{request.GET.q}}&page=1">&laquo;</a></li>';
        }
    }
    // middle pages
    for (let x = currentPage-2; x < currentPage+3; x++){
        if (x<1 || x>totalPages){continue;}
        if (x==currentPage){
            pages += `<li class="page-item active"><a class="page-link" href="?q={{request.GET.q}}&page=${x}&td={{request.GET.td}}">${x}</a></li>`;
        }else{
            pages += `<li class="page-item"><a class="page-link" href="?q={{request.GET.q}}&page=${x}&td={{request.GET.td}}">${x}</a></li>`;
        }
    }
    //last page
    if (currentPage<totalPages-2){
        pages += '<li class="page-item"><a class="page-link" href="?q={{request.GET.q}}&page={{wordsp.paginator.num_pages}}&td={{request.GET.td}}">&raquo;</a></li>';
    }
    {//if has Next
        `{% if wordsp.has_next %}
            ${pages += '<li class="page-item"><a class="page-link" href="?page={{ wordsp.next_page_number }}&q={{request.GET.q}}&td={{request.GET.td}}">Next</a></li>'}
        {% else %}
            ${pages += '<li class="page-item disabled"><span class="page-link">Next</span></li>'}
        {% endif %}`;
    }
    pages += `</ul></nav>`;
    pageEle.innerHTML = pages;
</script>

<!-- Dict Table Files
<script defer src="/static/js/web/jquery-3.6.3.min.js"></script>
<script src="/static/js/web/popper_2_11_6_min.js"></script>
<script src="/static/js/web/popper.bootstrap.min.js"></script>
-->
<!-- DATATABLES
<script defer src="/static/dt/pdfmake.min.js"></script>
<script defer src="/static/dt/vfs_fonts.js"></script>
<script defer src="/static/dt/datatables.min.js"></script>
-->
<!--
<script>//DataTables
    $(document).ready(function() {
        $('#example #columnFilters tr')//initially     $('#example thead tr')
            //.clone(true)
            .addClass('filters bg-secondary')
            .appendTo('#example #columnFilters'); //initially   $('#example thead')

        var table = $('#example').DataTable({
            // orderCellsTop: true,
            // fixedHeader: true,
            paging: true, //pagination
            pageLength: 10, //entries per page
            lengthChange: true, //show entries per page option
            autoWidth: false, //auto width for columns
            searching: true, //search bar
            bInfo: true, //bottom table info
            bSort: true, //sorting a-z 0-9

            //particular columns settings
            // "columnDefs": [
            //     {
            //         "width": "20%",
            //         "targets": [4,5], //4th and 5th column is not sortable
            //         "orderable": false
            //     },
            //     {
            //         "width": "10%",
            //         "targets": 0,
            //     },

            // ],

            initComplete: function() {
                var api = this.api();
                //columns to filter
                api
                    .columns()//.columns([0,1,2,3]) specify column no. if you want the filter for a particular column
                    .eq(0)
                    .each(function(colIdx) {
                        var cell = $('.filters th').eq(
                            $(api.column(colIdx).header()).index()
                        );
                        var title = $(cell).text();
                        $(cell).html('<input type="texg" placeholder="' + title + '"/>');
                        $(
                            'input',
                            $('.filters th').eq($(api.column(colIdx).header()).index())
                        )
                        .off('keyup change')
                        .on('keyup change', function(e) {
                            e.stopPropagation();
                            
                            $(this).attr('title',$(this).val());
                            var regexr = '({search})';

                            var cursorPosition = this.selectionStart;

                            api
                                .column(colIdx)
                                .search(
                                    this.value != ''
                                        ? regexr.replace('{search}', '(((' + this.value + ')))')
                                        : '',
                                    this.value != '',
                                    this.value == ''
                                )
                            .draw();
                        $(this)
                            .focus()[0]
                            .setSelectionRange(cursorPosition, cursorPosition)
                        });
                    });
            },
        //BUTTONS
        //dom: 'lBfrtip',
        // buttons: [
        //     {//COPY BUTTON
        //         extend: 'copy',
        //         text: '<i class="fa-solid fa-clone"></i>',
        //         className: 'btn btn-secondary',
        //         titleAttr: 'Copy',
        //         //SPECIFIED COLUMNS TO COPY
        //         exportOptions: {
        //             columns: [0,1,2,3,4,5]
        //         },
        //     },
        //     {//EXCEL BUTTON
        //         extend: 'excel',
        //         text: '<i class="fa-solid fa-file-excel"></i>',
        //         className: 'btn btn-success',
        //         titleAttr: 'Export to Excel',
        //         //SPECIFIED COLUMNS TO EXPORT
        //         exportOptions: {
        //             columns: [0,1,2,3,4,5]
        //         },
        //     },
        //     {//PRINT BUTTON
        //         extend: 'print',
        //         text: '<i class="fa-solid fa-print"></i>',
        //         className: 'btn btn-primary',
        //         titleAttr: 'Print',
        //         //SPECIFIED COLUMNS TO Print 
        //         exportOptions: {
        //             columns: [0,1,2,3,4,5]
        //         },
        //         customize: function(win) {
        //             $(win.document.body).css('font-size','10pt')
        //             $(win.document.body).find('table')
        //                 .addClass('compact')
        //                 .css('font-size','inherit');
        //         },
        //     },
        //     {//PDF BUTTON
        //         extend: 'pdf',
        //         text: '<i class="fa-solid fa-file-pdf"></i>',
        //         className: 'btn btn-danger',
        //         titleAttr: 'PDF',
        //         //SPECIFIED COLUMNS TO Print 
        //         exportOptions: {
        //             columns: [0,1,2,3,4,5]
        //         },
        //         //TABLE HEADER
        //         tableHeader: {
        //             alignment: 'center'
        //         },
        //         //FONT SIZE
        //         customize: function(doc) {

        //             doc.styles.title = {
        //                 color: 'red',
        //                 fontSize: '40',
        //                 background: 'blue',
        //                 alignment: 'center'
        //             }

        //             doc.defaultStyle.fontSize = 6;
        //             doc.styles.tableHeader.alignment = 'center';
        //             doc.styles.tableHeader.fontSize = 8;
        //             doc.styles.tableBodyOdd.alignment = 'center';
        //             doc.styles.tableBodyEven.alignment = 'center';
        //             //100% width of the table
        //             doc.content[1].table.widths = Array(doc.content[1].table.body[1].length + 1).join('*').split('');
        //         }
        //     },
        // ]
        });
    });
    
    // NOTE: set column width based on the columns number, multiplied by 20% of the screen
    //var tableExample = document.getElementById('example');
    //var tbr = tableExample.rows[0].cells.length*15;
    //tableExample.style.width = tbr+"rem";
</script>
-->

{% include "footer.html" %}
{% endblock body %}
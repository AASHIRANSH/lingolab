{% extends 'base.html' %}

{% block body %}
{% include 'english/flashcards/styles/flashcards.html' %}
{% include "header.html" %}

<div class="container-fluid bg-light py-4">
    <div class="row">
        <div class="col-12 col-lg-9 px-4 pe-lg-0 mb-5">
            {% include 'messages.html' %}
            <div class="bg-light p-3 mb-3 rounded shadow">
                <div class="d-flex justify-content-between align-items-center rounded">
                    <div class="row col-9">
                        <!-- Word Pos-->
                        <div class="col-12 mb-1">
                            <div id="word" class="col-auto text-primary d-inline-block me-2" {% if request.user.is_superuser %}onclick="window.location.assign('/english/wordedit?word_id={{word.id}}')"{% endif %}>
                                {{word.word}}
                            </div>
                            <div id="pos" class="col-auto fs-5 d-inline-block text-secondary me-2">
                                {{word.pos}}
                            </div>
                            {% if word.cefr %}
                                <div id="grade" class="col-auto d-inline-block fs-5 text-uppercase px-2">
                                    {{word.cefr}}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Option Buttons -->
                    <div class="col-3">
                        <div class="fs-5 fw-bold text-primary text-center mb-2">My Progress</div>
                        <div class="d-flex justify-content-center align-items-center bg-secondary bg-opacity-10 p-3 border border-5 border-primary mx-auto rounded-circle" style="width:7rem;height:7rem;">
                            <div class="fs-1 fw-bold text-primary">{{progress}}<span class="fs-4 text-secondary">%</span></div>
                        </div>
                    </div>
                </div>
            </div>
        
            {% for sense in senses %}
                <div class="p-2 {% if not forloop.last %}mb-3{% endif %} rounded shadow">
                    <div class="d-flex justify-content-between mb-1">
                        <div>
                            <span class="badge text-uppercase text-bg-primary bg-opacity-100" {% if request.user.is_superuser %}onclick="window.location.assign(`{% url 'word_entry' %}?edit=true&word={{word.pk}}&sense={{sense.0|add:-1}}`)"{% endif %}>sense {{sense.0}}</span>
                            <span class="badge text-uppercase text-bg-secondary bg-opacity-100">{{sense.2}}</span>
                            <div class="d-inline-block">
                                {% if sense.16.0 %}
                                    <a href="/english/dictionary/topics/{{sense.16.0.0}}" role="btn" class="btn btn-primary fs-8 p-0 px-2">
                                        TOPIC
                                        <span class="badge wsp-sm lsp-sm text-light text-uppercase text-bg-light bg-opacity-25">
                                            {{sense.16.0.0}} {{sense.16.1.0}}
                                        </span>
                                    </a>
                                {% endif %}
                                {% if sense.16.0.1 %}
                                    <a href="/english/dictionary/topics/{{sense.16.0.0}}" role="btn" class="btn btn-primary fs-8 p-0 px-1">
                                        TOPIC
                                        <span class="badge wsp-sm lsp-sm text-light text-uppercase text-bg-light bg-opacity-25">
                                            {{sense.16.0.1}} {{sense.16.1.1}}
                                        </span>
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                        <div>
                            <button id="btn{{sense.0}}" title="Already added" class="btn btn-outline-danger fs-6 p-0 px-2 rounded" onclick="favSet('remove',{{word.id}},{{sense.0}})"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>

                    <div class="fs-6">
                        {% if sense.6 %}<span class="d-inline-block bg-light bg-opacity-25 text-secondary border border-2 border-light p-0 px-1 mb-1 rounded">{{sense.6}}</span>{% endif %}
                        {% if sense.8 %}<span class="d-inline-block bg-light bg-opacity-25 text-secondary border border-2 border-light p-0 px-1 mb-1 rounded">{{sense.8}}</span>{% endif %}
                        {% if sense.7 %}<span class="d-inline-block bg-light bg-opacity-25 text-secondary border border-2 border-light p-0 px-1 mb-1 rounded">{{sense.7.0|safe}}{% if sense.7.1 %} {{sense.7.1|safe}}{% endif %}</span>{% endif %}
                    </div>

                    {% if sense.3 %}
                    {% for i in sense.3 %}
                        <span class="me-2">
                            <img class="word-image" src="/media/dictionary/img/thumb/{{i}}" onerror="this.onerror=null; this.src='/media/dictionary/image-regular.svg'" data-bs-toggle="modal" data-bs-target="#fullImage{{forloop.counter}}"/>
                        </span>
                        <div class="modal fade" id="fullImage{{forloop.counter}}" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="w-100 modal-content p-1">
                                <div class="">
                                    <img class="border border-4 rounded" style="width:100%;height:auto;" src="/media/dictionary/img/fullsize/{{i}}"/>
                                </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    {% endif %}
                    <div id="def-container" class="bg-white rounded p-1 mb-1 shadow-sm">
                        <div id="def" class="position-relative bg-primary bg-opacity-25 fs-4 p-3 rounded">
                            {% if sense.1 %}
                                <span class="d-inline-block bg-primary text-light text-uppercase fs-8 bg-opacity-75 p-1 mb-1">
                                    {{sense.1}}
                                </span>
                            {% endif %}
                            {% if sense.5 %}<span class="text-primary fs-5">{{sense.5}}</span>{% endif %}
                            {% if sense.4 %}<span class="text-primary fs-5">{{sense.4}}</span>{% endif %}

                            <ol class="circle_filled">
                            {% for x in sense.9.en.0 %}
                                <li class="lsp-sm wsp-sm ln-sm">
                                    {{x}}
                                </li>
                                {% if not forloop.last %}<hr>{% endif %}
                            {% endfor %}
                            </ol>

                            <div id="defHiCarousel{{sense.0}}" class="d-none carousel animate__animated animate__fadeIn">
                                <div class="carousel-inner definition" data-bs-target="#defHiCarousel{{sense.0}}" data-bs-slide="next">
                                    {% for x in sense.9.hi.0 %}
                                        <div class="carousel-item {% if forloop.counter == 1 %}active{% endif %}">
                                            {{x}}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>

                            <div class="position-absolute top-0 end-0 me-1">
                                <i class="fa-solid fa-language fs-3 text-primary cursor-pointer" data-action="dtog" data-target="defHiCarousel{{sense.0}}"></i>
                            </div>
                        </div>
                    </div>

                    {% if sense.10 %}
                        <div class="bg-white rounded p-1 shadow-sm">
                            <div id="example" class="example fs-5 fst-italic bg-gray bg-opacity-10 rounded pt-1 overflow-auto">
                                <ul>
                                    <hr class="my-1">
                                    {% for example in sense.10 %}
                                        <li class="example p-0">
                                            <!--&#x2022; bullet -->{{example}} <i class="fa-solid fa-volume-high cursor-pointer fs-6 text-primary" onclick="textToSpeech(this.parentNode.textContent, 'UK')"></i> <i class="fa-solid fa-volume-high cursor-pointer fs-6 text-danger" onclick="textToSpeech(this.parentNode.textContent, 'US')"></i>
                                        </li>
                                        <hr class="my-1">
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    {% endif %}

                    {% if note %}
                        <div class="modal fade" id="myNote" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <div class="modal-title bg-danger bg-opacity-75 text-white p-2 rounded fs-5" id="exampleModalLabel">My Note - Edit</div>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <form method="post" action="">
                                        <div class="modal-body">
                                            {% csrf_token %}
                                            <textarea id="textarea_note" class="form-control" name="note" rows="4" placeholder="Type here to make your note....">{% if word.note %}{{word.note}}{% endif %}</textarea>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-primary">Save changes</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    {% endif %}

                    {% if sense.17 %}
                        <div class="d-flex gap-2 bg-warning bg-opacity-25 p-3 rounded my-3">
                            <div class=""><i class="fa-solid fa-lightbulb text-warning fs-3"></i></div>
                            <div class="">{{sense.17|safe}}</div>
                        </div>
                    {% endif %}

                    {% if sense.18 %}
                        <div class="d-flex gap-2 bg-warning bg-opacity-25 p-3 rounded my-3">
                            <div class=""><i class="fa-solid fa-lightbulb text-warning fs-3"></i></div>
                            <div class="">{{sense.18|safe}}</div>
                        </div>
                    {% endif %}

                    {% if sense.19 %}
                        <div class="row accordion my-3">
                            {% for box in sense.19 %}
                            <div class="col-sm-12 col-lg-6 accordion my-1" id="accordionExample{{forloop.counter}}">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed p-1" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{forloop.counter}}" aria-expanded="true" aria-controls="collapseOne">
                                            <span class="d-inline-block bg-secondary text-white fw-bold wsp-sm lsp-sm fs-7 p-2 rounded">{{box.0|safe}}</span>
                                        </button>
                                    </h2>
                                    <div id="collapse{{forloop.counter}}" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                                        <div class="accordion-body shadow-sm">
                                            {{box.1|safe}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    {% if sense.11 %}
                        <div class="my-3 p-0">
                            <span class="d-inline-block bg-secondary text-white fw-bold wsp-sm lsp-sm fs-7 py-1 rounded px-2 mb-2">
                                SENTENCE USAGE PATTERN
                            </span>
                            <div class="ps-3">
                                {% for x in sense.11 %}
                                    <div class="d-flex bg-gray rounded mb-1">
                                        <div class="col-4 bg-secondary bg-opacity-10 text-primary fw-bold px-2 py-1 rounded">{{x.0}}</div> 
                                        <div class="col-8 px-2 py-1">&#x2022; {{x.1}}</div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}

                    {% if sense.15 %}
                        <div class="my-3 p-0">
                            <span class="d-inline-block bg-secondary text-white fw-bold wsp-sm lsp-sm fs-7 py-1 rounded px-2 mb-2">
                                SEE ALSO
                            </span>
                            <div class="d-flex flex-wrap gap-1 ps-3">
                                {% for x in sense.15 %}
                                    <a href="{% url "dictionary" %}?q={{x}}" class="text-dark bg-gray px-2 py-1 rounded">{{x}}</a>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}

                    <div class="{% if sense.13 and sense.12 %}d-flex flex-row gap-2{% endif %}">
                        {% if sense.12 %}
                            <div class="{% if sense.13 %}col {% endif %}p-0 my-3">
                                <span class="d-inline-block bg-primary text-white fw-bold wsp-sm lsp-sm fs-7 rounded py-1 px-2 mb-2">
                                    SYNONYMS
                                </span>
                                <div class="d-flex flex-wrap gap-1 ps-3">
                                    {% for x in sense.12 %}
                                        <a href="{% url "dictionary" %}?q={{x}}" class="text-dark bg-gray px-2 py-1 rounded">{{x}}</a>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}

                        {% if sense.13 %}
                            <div class="{% if sense.12 %}col {% endif %}p-0 my-3">
                                <span class="d-inline-block bg-danger text-white fw-bold wsp-sm lsp-sm fs-7 rounded py-1 px-2 mb-2">
                                    ANTONYMS
                                </span>
                                <div class="d-flex flex-wrap gap-1 ps-3">
                                    {% for x in sense.13 %}
                                        <a href="{% url "dictionary" %}?q={{x}}" class="text-dark bg-gray px-2 py-1 rounded">{{x}}</a>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    </div>

                    {% if sense.14 %}
                        <div class="my-3 p-0">
                            <span class="d-inline-block bg-secondary text-white fw-bold wsp-sm lsp-sm fs-7 rounded py-1 px-2 mb-2">
                                COMPARE
                            </span>
                            <div class="d-flex gap-1 ps-3">
                                {% for x in sense.14 %}
                                    <a href="{% url "dictionary" %}?q={{x}}" class="text-dark bg-gray px-2 py-1 rounded">{{x}}</a>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}

                    {% if word.related_post.count %}
                        <div class="my-3 p-0">
                            <span class="d-inline-block bg-secondary text-white fw-bold wsp-sm lsp-sm fs-7 rounded py-1 px-2 mb-2">
                                RELATED POST
                            </span>
                            <div id="related_post" class="d-flex gap-1 ps-3">
                                {% for post in word.related_post.all %}
                                    <button class="btn btn-outline-primary px-2 py-1" onclick="window.location.assign(`{% url 'post_detail' post.pk %}`)">
                                        {{post.title}}
                                    </button>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}

                    {% if collocation %}
                        <div class="my-3 p-0">
                            <div class="bg-secondary text-white rounded-3 py-1 px-2 mb-2">
                                collocation
                            </div>
                            <div class="d-flex gap-1 px-2">
                                <a class="btn btn-secondary" href="{% url "collocation_view" collocation.id %}">{{collocation}}</a>
                            </div>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}

            <!--div class="col-12 col-lg-3 px-4 px-lg-2">
                <div class="position-sticky sticky bg-light p-2 rounded shadow">
                    <div class="d-flex justify-content-between align-items-center border-bottom border-grey mb-2">
                        <h5 class="text-secondary">Nearby words</h5>
                        <div class="">
                            <a href="{% url "word" word.pk|add:-1 %}" class="btn btn-grey" role="button" title="short-key alt+z" accesskey="z">&lt;</a>
                            <a href="{% url "word" word.pk|add:1 %}" class="btn btn-grey" role="button" title="short-key alt+x" accesskey="x">&gt;</a>
                        </div>
                    </div>
                    {% for w in nw %}
                        {% if word.pk == w.pk %}
                            <a class="d-block bg-secondary bg-opacity-25 fw-bold text-secondary px-2 py-1 my-1 rounded">{{w.word}}</a>
                        {% else %}
                            <a href="{% url 'word' w.pk %}" class="d-block text-secondary hover-gray px-1 my-1 rounded">{{w.word}}</a>
                        {% endif %}
                    {% endfor %}
                    <div class="my-2">
                        <form action="{% url "dictionary" %}">
                            <input type="search" name="q" class="form-control" placeholder="Type to search..." value="{{request.GET.q}}" autocomplete="off"/>
                        </form>
                    </div>
                </div>
            </div-->
        </div>
    </div>
</div>

{% include 'tts_2.html' %}
{% include 'english/flashcards/scripts/script.html' %}

{% endblock body %}